#!/bin/sh

readonly THIS_DIR=$(dirname $0)
. $THIS_DIR/../webpipe-lib.sh

main() {
  local input=$1
  local output=$2

  mkdir -p $output
  # original JSON file will be referenced.
  cp $input $output/
  cp $THIS_DIR/shell.html 

  local filename=$(basename $input)
  
  cat >$output/index.html <<EOF
<html>
  <head>
    <title>json $output</title>
    <link href="/plugins/json/static/jsontree.css" rel="stylesheet">
    <script src="/plugins/json/static/jsontree.js"></script>
  </head>

  <body>
    <div id="content"></div>
  </body>

  <script type="text/javascript">
    JSONTree.getAndRender("$filename", document.getElementById("content"));
  </script>

</html>
EOF

  echo $output

  local html=$output.html

  # TODO: Preview in the snippet.  Should give first 10 and
  # last 10 lines in here?  Should we use Python, or just head/tail and wc?
  # could display: 1024 characters, 1323 lines.

  cat >$html <<EOF
<a href="$output">navigate json</a> <br />

<a href="$output/$filename">raw json</a> <br />
EOF

  echo $html
}

main "$@"

